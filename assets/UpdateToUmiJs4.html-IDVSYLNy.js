import{_ as n,c as a,a as t,o as p}from"./app-Bah7_sEf.js";const e={};function o(i,s){return p(),a("div",null,s[0]||(s[0]=[t(`<blockquote><p>公司的一个前端项目用了AndDesign Pro V5，想着跟着大公司走，能够有所参照，不过后来还是停更了。Umi4和AntDesign5都已经发布了，为了保持项目的活性，还是升下级。考虑先升级UmiJS4，没啥问题了再升级AntDesign5</p></blockquote><h2 id="package-json的调整" tabindex="-1"><a class="header-anchor" href="#package-json的调整"><span>package.json的调整</span></a></h2><p>因为package里面的东西比较多，所以分部分说。</p><h3 id="非依赖部分" tabindex="-1"><a class="header-anchor" href="#非依赖部分"><span>非依赖部分</span></a></h3><p>AndDesignPro的Github仓库已经有6.0.0beta版本了，因此除了dependencies和devDependencies部分可以直接拷贝仓库中的，如果有自定义的配置，拷过来即可</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js" data-title="js"><pre><code><span class="line">  <span class="token string-property property">&quot;scripts&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token string-property property">&quot;analyze&quot;</span><span class="token operator">:</span> <span class="token string">&quot;cross-env ANALYZE=1 max build&quot;</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token string-property property">&quot;build&quot;</span><span class="token operator">:</span> <span class="token string">&quot;max build&quot;</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token string-property property">&quot;deploy&quot;</span><span class="token operator">:</span> <span class="token string">&quot;npm run build &amp;&amp; npm run gh-pages&quot;</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token string-property property">&quot;dev&quot;</span><span class="token operator">:</span> <span class="token string">&quot;npm run start:dev&quot;</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token string-property property">&quot;gh-pages&quot;</span><span class="token operator">:</span> <span class="token string">&quot;gh-pages -d dist&quot;</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token string-property property">&quot;i18n-remove&quot;</span><span class="token operator">:</span> <span class="token string">&quot;pro i18n-remove --locale=zh-CN --write&quot;</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token string-property property">&quot;postinstall&quot;</span><span class="token operator">:</span> <span class="token string">&quot;max setup&quot;</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token string-property property">&quot;jest&quot;</span><span class="token operator">:</span> <span class="token string">&quot;jest&quot;</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token string-property property">&quot;lint&quot;</span><span class="token operator">:</span> <span class="token string">&quot;npm run lint:js &amp;&amp; npm run lint:prettier &amp;&amp; npm run tsc&quot;</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token string-property property">&quot;lint-staged&quot;</span><span class="token operator">:</span> <span class="token string">&quot;lint-staged&quot;</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token string-property property">&quot;lint-staged:js&quot;</span><span class="token operator">:</span> <span class="token string">&quot;eslint --ext .js,.jsx,.ts,.tsx &quot;</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token string-property property">&quot;lint:fix&quot;</span><span class="token operator">:</span> <span class="token string">&quot;eslint --fix --cache --ext .js,.jsx,.ts,.tsx --format=pretty ./src &quot;</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token string-property property">&quot;lint:js&quot;</span><span class="token operator">:</span> <span class="token string">&quot;eslint --cache --ext .js,.jsx,.ts,.tsx --format=pretty ./src&quot;</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token string-property property">&quot;lint:prettier&quot;</span><span class="token operator">:</span> <span class="token string">&quot;prettier -c --write \\&quot;**/**.{js,jsx,tsx,ts,less,md,json}\\&quot; --end-of-line auto&quot;</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token string-property property">&quot;openapi&quot;</span><span class="token operator">:</span> <span class="token string">&quot;max openapi&quot;</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token string-property property">&quot;prepare&quot;</span><span class="token operator">:</span> <span class="token string">&quot;husky install&quot;</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token string-property property">&quot;prettier&quot;</span><span class="token operator">:</span> <span class="token string">&quot;prettier -c --write \\&quot;**/**.{js,jsx,tsx,ts,less,md,json}\\&quot;&quot;</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token string-property property">&quot;preview&quot;</span><span class="token operator">:</span> <span class="token string">&quot;npm run build &amp;&amp; max preview --port 8000&quot;</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token string-property property">&quot;record&quot;</span><span class="token operator">:</span> <span class="token string">&quot;cross-env NODE_ENV=development REACT_APP_ENV=test max record --scene=login&quot;</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token string-property property">&quot;serve&quot;</span><span class="token operator">:</span> <span class="token string">&quot;umi-serve&quot;</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token string-property property">&quot;start&quot;</span><span class="token operator">:</span> <span class="token string">&quot;cross-env UMI_ENV=dev max dev&quot;</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token string-property property">&quot;start:dev&quot;</span><span class="token operator">:</span> <span class="token string">&quot;cross-env REACT_APP_ENV=dev MOCK=none UMI_ENV=dev max dev&quot;</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token string-property property">&quot;start:no-mock&quot;</span><span class="token operator">:</span> <span class="token string">&quot;cross-env MOCK=none UMI_ENV=dev max dev&quot;</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token string-property property">&quot;start:pre&quot;</span><span class="token operator">:</span> <span class="token string">&quot;cross-env REACT_APP_ENV=pre UMI_ENV=dev max dev&quot;</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token string-property property">&quot;start:test&quot;</span><span class="token operator">:</span> <span class="token string">&quot;cross-env REACT_APP_ENV=test MOCK=none UMI_ENV=dev max dev&quot;</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token string-property property">&quot;test&quot;</span><span class="token operator">:</span> <span class="token string">&quot;jest&quot;</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token string-property property">&quot;test:coverage&quot;</span><span class="token operator">:</span> <span class="token string">&quot;npm run jest -- --coverage&quot;</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token string-property property">&quot;test:update&quot;</span><span class="token operator">:</span> <span class="token string">&quot;npm run jest -- -u&quot;</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token string-property property">&quot;tsc&quot;</span><span class="token operator">:</span> <span class="token string">&quot;tsc --noEmit&quot;</span></span>
<span class="line">  <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">  <span class="token string-property property">&quot;lint-staged&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token string-property property">&quot;**/*.{js,jsx,ts,tsx}&quot;</span><span class="token operator">:</span> <span class="token string">&quot;npm run lint-staged:js&quot;</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token string-property property">&quot;**/*.{js,jsx,tsx,ts,less,md,json}&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span></span>
<span class="line">      <span class="token string">&quot;prettier --write&quot;</span></span>
<span class="line">    <span class="token punctuation">]</span></span>
<span class="line">  <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">  <span class="token string-property property">&quot;browserslist&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span></span>
<span class="line">    <span class="token string">&quot;&gt; 1%&quot;</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token string">&quot;last 2 versions&quot;</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token string">&quot;not ie &lt;= 10&quot;</span></span>
<span class="line">  <span class="token punctuation">]</span><span class="token punctuation">,</span></span>
<span class="line"></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js" data-title="js"><pre><code><span class="line">  <span class="token string-property property">&quot;engines&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token string-property property">&quot;node&quot;</span><span class="token operator">:</span> <span class="token string">&quot;&gt;=12.0.0&quot;</span></span>
<span class="line">  <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">  <span class="token string-property property">&quot;create-umi&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token string-property property">&quot;ignoreScript&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span></span>
<span class="line">      <span class="token string">&quot;docker*&quot;</span><span class="token punctuation">,</span></span>
<span class="line">      <span class="token string">&quot;functions*&quot;</span><span class="token punctuation">,</span></span>
<span class="line">      <span class="token string">&quot;site&quot;</span><span class="token punctuation">,</span></span>
<span class="line">      <span class="token string">&quot;generateMock&quot;</span></span>
<span class="line">    <span class="token punctuation">]</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token string-property property">&quot;ignoreDependencies&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span></span>
<span class="line">      <span class="token string">&quot;netlify*&quot;</span><span class="token punctuation">,</span></span>
<span class="line">      <span class="token string">&quot;serverless&quot;</span></span>
<span class="line">    <span class="token punctuation">]</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token string-property property">&quot;ignore&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span></span>
<span class="line">      <span class="token string">&quot;.dockerignore&quot;</span><span class="token punctuation">,</span></span>
<span class="line">      <span class="token string">&quot;.git&quot;</span><span class="token punctuation">,</span></span>
<span class="line">      <span class="token string">&quot;.github&quot;</span><span class="token punctuation">,</span></span>
<span class="line">      <span class="token string">&quot;.gitpod.yml&quot;</span><span class="token punctuation">,</span></span>
<span class="line">      <span class="token string">&quot;CODE_OF_CONDUCT.md&quot;</span><span class="token punctuation">,</span></span>
<span class="line">      <span class="token string">&quot;Dockerfile&quot;</span><span class="token punctuation">,</span></span>
<span class="line">      <span class="token string">&quot;Dockerfile.*&quot;</span><span class="token punctuation">,</span></span>
<span class="line">      <span class="token string">&quot;lambda&quot;</span><span class="token punctuation">,</span></span>
<span class="line">      <span class="token string">&quot;LICENSE&quot;</span><span class="token punctuation">,</span></span>
<span class="line">      <span class="token string">&quot;netlify.toml&quot;</span><span class="token punctuation">,</span></span>
<span class="line">      <span class="token string">&quot;README.*.md&quot;</span><span class="token punctuation">,</span></span>
<span class="line">      <span class="token string">&quot;azure-pipelines.yml&quot;</span><span class="token punctuation">,</span></span>
<span class="line">      <span class="token string">&quot;docker&quot;</span><span class="token punctuation">,</span></span>
<span class="line">      <span class="token string">&quot;CNAME&quot;</span><span class="token punctuation">,</span></span>
<span class="line">      <span class="token string">&quot;create-umi&quot;</span></span>
<span class="line">    <span class="token punctuation">]</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>这里最大的变化就是umi的启动指令变了、测试的指令变了、prettier通配符更加细致了、删除了gitHooks的配置、增加了create-umi的配置</p><h3 id="依赖部分" tabindex="-1"><a class="header-anchor" href="#依赖部分"><span>依赖部分</span></a></h3><p>因为本次只考虑升级umijs，因此不能直接使用Github中的，这里需要手动操作</p><ul><li>react-dev-inspector从dependencies移动到devDependencies</li><li>移除dependencies中的umi，移除devDependencies中的umi-plugin-，@umijs/plugin- 和 @umijs/preset- 开头的所有依赖。</li><li>devDependencies增加@umijs/max、husky和umi-presets-pro</li></ul><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js" data-title="js"><pre><code><span class="line">    <span class="token string-property property">&quot;husky&quot;</span><span class="token operator">:</span> <span class="token string">&quot;^7.0.4&quot;</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token string-property property">&quot;umi-presets-pro&quot;</span><span class="token operator">:</span> <span class="token string">&quot;^2.0.3&quot;</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token string-property property">&quot;@umijs/max&quot;</span><span class="token operator">:</span> <span class="token string">&quot;^4.0.0&quot;</span></span>
<span class="line"></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>升级过后可能有些包已经没用了，但是这里先不慌，先就这样，后续看看有没有其他问题</p><h2 id="config" tabindex="-1"><a class="header-anchor" href="#config"><span>Config</span></a></h2><h2 id="app-tsx" tabindex="-1"><a class="header-anchor" href="#app-tsx"><span>app.tsx</span></a></h2><p>升级到umijs4后initialStateConfig已经没有了，要删掉</p><div class="language-typescript line-numbers-mode" data-highlighter="prismjs" data-ext="ts" data-title="ts"><pre><code><span class="line"><span class="token doc-comment comment">/** 获取用户信息比较慢的时候会展示一个 loading */</span></span>
<span class="line"><span class="token keyword">export</span> <span class="token keyword">const</span> initialStateConfig <span class="token operator">=</span> <span class="token punctuation">{</span></span>
<span class="line">  loading<span class="token operator">:</span> <span class="token operator">&lt;</span>PageLoading <span class="token operator">/</span><span class="token operator">&gt;</span><span class="token punctuation">,</span></span>
<span class="line"><span class="token punctuation">}</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>request前置url也已经变了</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js" data-title="js"><pre><code><span class="line"><span class="token keyword">export</span> <span class="token keyword">const</span> <span class="token literal-property property">request</span><span class="token operator">:</span> RequestConfig <span class="token operator">=</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token comment">// 配置umi-request的前置url</span></span>
<span class="line">  <span class="token literal-property property">baseURL</span><span class="token operator">:</span> <span class="token string">&quot;http://localhoast:5000&quot;</span><span class="token punctuation">,</span></span>
<span class="line">  <span class="token comment">// umijs4已经换成了axios，这种配置失效了</span></span>
<span class="line">  <span class="token comment">// prefix: UserExtensionConfig.BaseUrl,</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>原本使用的prefix，现在则是直接透传axios的配置，因此要使用baseURL进行设置了</p>`,20)]))}const r=n(e,[["render",o]]),c=JSON.parse('{"path":"/React/UpdateToUmiJs4.html","title":"升级到UmiJS4","lang":"zh-CN","frontmatter":{"title":"升级到UmiJS4"},"headers":[{"level":2,"title":"package.json的调整","slug":"package-json的调整","link":"#package-json的调整","children":[{"level":3,"title":"非依赖部分","slug":"非依赖部分","link":"#非依赖部分","children":[]},{"level":3,"title":"依赖部分","slug":"依赖部分","link":"#依赖部分","children":[]}]},{"level":2,"title":"Config","slug":"config","link":"#config","children":[]},{"level":2,"title":"app.tsx","slug":"app-tsx","link":"#app-tsx","children":[]}],"git":{"updatedTime":1719972785000,"contributors":[{"name":"吴俊城","email":"wujunchngman@163.com","commits":1}]},"filePathRelative":"React/UpdateToUmiJs4.md"}');export{r as comp,c as data};
